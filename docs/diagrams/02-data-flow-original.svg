<svg width="1200" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="flowGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="arrowheadBlue" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#007bff" />
    </marker>
    <marker id="arrowheadGreen" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#28a745" />
    </marker>
    <marker id="arrowheadRed" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc3545" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="900" fill="#f8f9fa" stroke="#e9ecef" stroke-width="2"/>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50">
    AI Customer Service Agent - Data Flow Architecture
  </text>

  <!-- Customer Interaction Start -->
  <g id="customerStart">
    <circle cx="100" cy="120" r="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="3"/>
    <text x="100" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1976d2">Customer</text>
    <text x="100" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1976d2">Inquiry</text>
  </g>

  <!-- Session Manager -->
  <g id="sessionMgr">
    <rect x="220" y="80" width="160" height="80" fill="#fff3cd" stroke="#856404" stroke-width="2" rx="10"/>
    <text x="300" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#856404">Session Manager</text>
    <text x="300" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">InMemorySessionService</text>
    <text x="300" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Context Tracking</text>
    <text x="300" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">History Management</text>
  </g>

  <!-- Agent Core -->
  <g id="agentCore">
    <rect x="450" y="60" width="200" height="120" fill="#e8f5e8" stroke="#28a745" stroke-width="3" rx="15"/>
    <text x="550" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#28a745">Betty's Bird Brain Agent</text>
    <text x="550" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#666">Gemini 2.5 Flash</text>
    <text x="550" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Intent Classification</text>
    <text x="550" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Tool Selection Logic</text>
    <text x="550" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Response Generation</text>
    <text x="550" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Guardrail Enforcement</text>
  </g>

  <!-- Intent Classification -->
  <g id="intentClass">
    <rect x="720" y="80" width="160" height="80" fill="#f8d7da" stroke="#dc3545" stroke-width="2" rx="10"/>
    <text x="800" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#dc3545">Intent Classifier</text>
    <text x="800" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Product Query</text>
    <text x="800" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Store Information</text>
    <text x="800" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Bird Care Advice</text>
  </g>

  <!-- Tool Router -->
  <g id="toolRouter">
    <rect x="950" y="80" width="160" height="80" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="10"/>
    <text x="1030" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#28a745">Tool Router</text>
    <text x="1030" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Dynamic Selection</text>
    <text x="1030" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Parallel Execution</text>
    <text x="1030" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Result Aggregation</text>
  </g>

  <!-- Tool 1: Database -->
  <g id="dbTool">
    <rect x="200" y="300" width="180" height="100" fill="#fff" stroke="#dc3545" stroke-width="3" rx="10"/>
    <text x="290" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#dc3545">Database Tool</text>
    <text x="290" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">MCP Toolbox Integration</text>
    <text x="290" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">MySQL Query Execution</text>
    <text x="290" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Real-time Pricing</text>
    <text x="290" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Inventory Lookup</text>
  </g>

  <!-- Tool 2: Datastore Search -->
  <g id="datastoreTool">
    <rect x="420" y="300" width="180" height="100" fill="#fff" stroke="#6f42c1" stroke-width="3" rx="10"/>
    <text x="510" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#6f42c1">Datastore Search</text>
    <text x="510" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Vertex AI Search</text>
    <text x="510" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Document Retrieval</text>
    <text x="510" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Semantic Search</text>
    <text x="510" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Content Extraction</text>
  </g>

  <!-- Tool 3: Web Search -->
  <g id="webTool">
    <rect x="640" y="300" width="180" height="100" fill="#fff" stroke="#20c997" stroke-width="3" rx="10"/>
    <text x="730" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#20c997">Web Search Tool</text>
    <text x="730" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Google Search API</text>
    <text x="730" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Current Research</text>
    <text x="730" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Trend Analysis</text>
    <text x="730" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Fact Verification</text>
  </g>

  <!-- Data Sources Layer -->
  <g id="dataSources">
    <!-- Product Database -->
    <rect x="150" y="500" width="140" height="80" fill="#ffe6e6" stroke="#dc3545" stroke-width="2" rx="8"/>
    <text x="220" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#dc3545">Product DB</text>
    <text x="220" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">MySQL</text>
    <text x="220" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Inventory</text>
    <text x="220" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Pricing</text>

    <!-- Store Documents -->
    <rect x="320" y="500" width="140" height="80" fill="#f0e6ff" stroke="#6f42c1" stroke-width="2" rx="8"/>
    <text x="390" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6f42c1">Store Docs</text>
    <text x="390" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">PDFs</text>
    <text x="390" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Hours</text>
    <text x="390" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">History</text>

    <!-- Knowledge Base -->
    <rect x="490" y="500" width="140" height="80" fill="#f0e6ff" stroke="#6f42c1" stroke-width="2" rx="8"/>
    <text x="560" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6f42c1">Knowledge Base</text>
    <text x="560" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Staff Info</text>
    <text x="560" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Policies</text>
    <text x="560" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">FAQs</text>

    <!-- External Web -->
    <rect x="660" y="500" width="140" height="80" fill="#e6fff0" stroke="#20c997" stroke-width="2" rx="8"/>
    <text x="730" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#20c997">External Web</text>
    <text x="730" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Research</text>
    <text x="730" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">News</text>
    <text x="730" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Trends</text>
  </g>

  <!-- Response Synthesis -->
  <g id="responseSynth">
    <rect x="450" y="680" width="200" height="80" fill="#d1ecf1" stroke="#0c5460" stroke-width="2" rx="10"/>
    <text x="550" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#0c5460">Response Synthesis</text>
    <text x="550" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Data Integration</text>
    <text x="550" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Context Enrichment</text>
    <text x="550" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Natural Language Gen</text>
  </g>

  <!-- Quality Control -->
  <g id="qualityControl">
    <rect x="700" y="680" width="160" height="80" fill="#fff3cd" stroke="#856404" stroke-width="2" rx="10"/>
    <text x="780" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#856404">Quality Control</text>
    <text x="780" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Guardrail Check</text>
    <text x="780" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Topic Validation</text>
    <text x="780" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Safety Filter</text>
  </g>

  <!-- Final Response -->
  <g id="finalResponse">
    <circle cx="1050" cy="720" r="40" fill="#d4edda" stroke="#28a745" stroke-width="3"/>
    <text x="1050" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#28a745">Final</text>
    <text x="1050" y="730" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#28a745">Response</text>
  </g>

  <!-- Data Flow Lines -->
  <!-- Customer to Session -->
  <line x1="140" y1="120" x2="220" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowheadBlue)"/>
  <text x="180" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#007bff">Query</text>

  <!-- Session to Agent -->
  <line x1="380" y1="120" x2="450" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowheadBlue)"/>

  <!-- Agent to Intent -->
  <line x1="650" y1="120" x2="720" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowheadBlue)"/>

  <!-- Intent to Router -->
  <line x1="880" y1="120" x2="950" y2="120" stroke="#007bff" stroke-width="3" marker-end="url(#arrowheadBlue)"/>

  <!-- Router to Tools -->
  <line x1="1000" y1="160" x2="290" y2="300" stroke="#dc3545" stroke-width="2" marker-end="url(#arrowheadRed)"/>
  <line x1="1020" y1="160" x2="510" y2="300" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1040" y1="160" x2="730" y2="300" stroke="#20c997" stroke-width="2" marker-end="url(#arrowheadGreen)"/>

  <!-- Tools to Data Sources -->
  <line x1="290" y1="400" x2="220" y2="500" stroke="#dc3545" stroke-width="2" marker-end="url(#arrowheadRed)"/>
  <line x1="510" y1="400" x2="390" y2="500" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="510" y1="400" x2="560" y2="500" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="730" y1="400" x2="730" y2="500" stroke="#20c997" stroke-width="2" marker-end="url(#arrowheadGreen)"/>

  <!-- Data Sources back to Tools (return path) -->
  <line x1="220" y1="500" x2="290" y2="400" stroke="#dc3545" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="390" y1="500" x2="510" y2="400" stroke="#6f42c1" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="560" y1="500" x2="510" y2="400" stroke="#6f42c1" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="730" y1="500" x2="730" y2="400" stroke="#20c997" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- Tools to Response Synthesis -->
  <line x1="380" y1="350" x2="480" y2="680" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="510" y1="400" x2="530" y2="680" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="640" y1="350" x2="570" y2="680" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Response Synthesis to Quality Control -->
  <line x1="650" y1="720" x2="700" y2="720" stroke="#856404" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Quality Control to Final Response -->
  <line x1="860" y1="720" x2="1010" y2="720" stroke="#28a745" stroke-width="3" marker-end="url(#arrowheadGreen)"/>

  <!-- Flow Direction Labels -->
  <text x="600" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#666">Parallel Tool Execution</text>
  <text x="550" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#666">Data Aggregation</text>

  <!-- Flow Legend -->
  <g id="legend">
    <rect x="50" y="800" width="300" height="80" fill="#fff" stroke="#ccc" stroke-width="1" rx="5"/>
    <text x="60" y="820" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Data Flow Legend:</text>
    <line x1="60" y1="835" x2="90" y2="835" stroke="#007bff" stroke-width="3"/>
    <text x="95" y="840" font-family="Arial, sans-serif" font-size="10" fill="#666">Primary Flow</text>
    <line x1="60" y1="850" x2="90" y2="850" stroke="#333" stroke-width="2" stroke-dasharray="5,5"/>
    <text x="95" y="855" font-family="Arial, sans-serif" font-size="10" fill="#666">Return Data</text>
    <line x1="60" y1="865" x2="90" y2="865" stroke="#28a745" stroke-width="3"/>
    <text x="95" y="870" font-family="Arial, sans-serif" font-size="10" fill="#666">Final Output</text>
  </g>
</svg>