<svg width="1200" height="1200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="decisionGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#ff9a9e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fecfef;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="arrowheadGreen" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#28a745" />
    </marker>
    <marker id="arrowheadRed" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc3545" />
    </marker>
    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="#000000" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1200" height="1200" fill="#f8f9fa" stroke="#e9ecef" stroke-width="2"/>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50">
    Agent Decision Flow - Betty's Bird Brain Processing Logic
  </text>

  <!-- Start Node -->
  <g id="startNode">
    <circle cx="600" cy="100" r="30" fill="#28a745" stroke="#1e7e34" stroke-width="2" filter="url(#dropShadow)"/>
    <text x="600" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">START</text>
  </g>

  <!-- Input Processing -->
  <g id="inputProcessing">
    <rect x="520" y="160" width="160" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="10" filter="url(#dropShadow)"/>
    <text x="600" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1976d2">Receive Customer</text>
    <text x="600" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1976d2">Input Message</text>
    <text x="600" y="210" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Parse & Sanitize</text>
  </g>

  <!-- Session Check -->
  <g id="sessionCheck">
    <polygon points="600,260 660,290 600,320 540,290" fill="#fff3cd" stroke="#856404" stroke-width="2" filter="url(#dropShadow)"/>
    <text x="600" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#856404">Session</text>
    <text x="600" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#856404">Exists?</text>
  </g>

  <!-- Create Session -->
  <g id="createSession">
    <rect x="720" y="260" width="140" height="60" fill="#d1ecf1" stroke="#0c5460" stroke-width="2" rx="8"/>
    <text x="790" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0c5460">Create New</text>
    <text x="790" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0c5460">Session</text>
    <text x="790" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Initialize Context</text>
  </g>

  <!-- Load Session -->
  <g id="loadSession">
    <rect x="380" y="260" width="140" height="60" fill="#d1ecf1" stroke="#0c5460" stroke-width="2" rx="8"/>
    <text x="450" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0c5460">Load Existing</text>
    <text x="450" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0c5460">Session</text>
    <text x="450" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Restore Context</text>
  </g>

  <!-- Guardrail Check -->
  <g id="guardrailCheck">
    <polygon points="600,380 680,410 600,440 520,410" fill="#f8d7da" stroke="#dc3545" stroke-width="2" filter="url(#dropShadow)"/>
    <text x="600" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#dc3545">Topic Within</text>
    <text x="600" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#dc3545">Bird/Store Scope?</text>
    <text x="600" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Guardrail Validation</text>
  </g>

  <!-- Off-Topic Response -->
  <g id="offTopicResponse">
    <rect x="850" y="380" width="160" height="60" fill="#f5c6cb" stroke="#721c24" stroke-width="2" rx="8"/>
    <text x="930" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#721c24">Generate</text>
    <text x="930" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#721c24">Polite Redirect</text>
    <text x="930" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Back to Birds/Store</text>
  </g>

  <!-- Intent Classification -->
  <g id="intentClassification">
    <polygon points="600,500 680,530 600,560 520,530" fill="#d4edda" stroke="#28a745" stroke-width="2" filter="url(#dropShadow)"/>
    <text x="600" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#28a745">Classify Intent</text>
    <text x="600" y="535" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#28a745">& Context</text>
    <text x="600" y="550" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">LLM Analysis</text>
  </g>

  <!-- Product Intent -->
  <g id="productIntent">
    <rect x="150" y="620" width="140" height="80" fill="#fff" stroke="#dc3545" stroke-width="2" rx="8"/>
    <text x="220" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#dc3545">Product/Pricing</text>
    <text x="220" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#dc3545">Query Intent</text>
    <text x="220" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Database Tool</text>
    <text x="220" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">MCP Toolbox</text>
  </g>

  <!-- Store Intent -->
  <g id="storeIntent">
    <rect x="320" y="620" width="140" height="80" fill="#fff" stroke="#6f42c1" stroke-width="2" rx="8"/>
    <text x="390" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6f42c1">Store Information</text>
    <text x="390" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6f42c1">Query Intent</text>
    <text x="390" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Datastore Tool</text>
    <text x="390" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Vertex AI Search</text>
  </g>

  <!-- Care Intent -->
  <g id="careIntent">
    <rect x="490" y="620" width="140" height="80" fill="#fff" stroke="#20c997" stroke-width="2" rx="8"/>
    <text x="560" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#20c997">Bird Care/Advice</text>
    <text x="560" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#20c997">Query Intent</text>
    <text x="560" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Web Search Tool</text>
    <text x="560" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Google Search</text>
  </g>

  <!-- Mixed Intent -->
  <g id="mixedIntent">
    <rect x="660" y="620" width="140" height="80" fill="#fff" stroke="#fd7e14" stroke-width="2" rx="8"/>
    <text x="730" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#fd7e14">Mixed/Complex</text>
    <text x="730" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#fd7e14">Query Intent</text>
    <text x="730" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Multiple Tools</text>
    <text x="730" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Orchestration</text>
  </g>

  <!-- General Intent -->
  <g id="generalIntent">
    <rect x="830" y="620" width="140" height="80" fill="#fff" stroke="#6c757d" stroke-width="2" rx="8"/>
    <text x="900" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6c757d">General/Other</text>
    <text x="900" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6c757d">Query Intent</text>
    <text x="900" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Contextual</text>
    <text x="900" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Response</text>
  </g>

  <!-- Tool Execution -->
  <g id="toolExecution">
    <rect x="450" y="750" width="300" height="60" fill="#e8f5e8" stroke="#28a745" stroke-width="2" rx="10" filter="url(#dropShadow)"/>
    <text x="600" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#28a745">Execute Selected Tool(s)</text>
    <text x="600" y="785" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Parallel execution for multiple tools</text>
    <text x="600" y="800" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Error handling and fallback logic</text>
  </g>

  <!-- Tool Success Check -->
  <g id="toolSuccessCheck">
    <polygon points="600,860 670,890 600,920 530,890" fill="#fff3cd" stroke="#856404" stroke-width="2" filter="url(#dropShadow)"/>
    <text x="600" y="880" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#856404">Tool Execution</text>
    <text x="600" y="895" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#856404">Successful?</text>
    <text x="600" y="910" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Result Validation</text>
  </g>

  <!-- Error Handling -->
  <g id="errorHandling">
    <rect x="800" y="860" width="160" height="60" fill="#f5c6cb" stroke="#721c24" stroke-width="2" rx="8"/>
    <text x="880" y="880" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#721c24">Handle Error</text>
    <text x="880" y="895" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#721c24">& Fallback</text>
    <text x="880" y="910" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Graceful Degradation</text>
  </g>

  <!-- Response Generation -->
  <g id="responseGeneration">
    <rect x="450" y="980" width="300" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="10" filter="url(#dropShadow)"/>
    <text x="600" y="1005" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1976d2">Generate Natural Language Response</text>
    <text x="600" y="1020" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Synthesize tool results with context</text>
    <text x="600" y="1035" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Apply personality and business rules</text>
    <text x="600" y="1050" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Include visit encouragement</text>
  </g>

  <!-- Final Response -->
  <g id="finalResponse">
    <circle cx="600" cy="1130" r="30" fill="#28a745" stroke="#1e7e34" stroke-width="2" filter="url(#dropShadow)"/>
    <text x="600" y="1125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">DELIVER</text>
    <text x="600" y="1138" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">RESPONSE</text>
  </g>

  <!-- Connection Lines -->
  <!-- Start to Input -->
  <line x1="600" y1="130" x2="600" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Input to Session Check -->
  <line x1="600" y1="220" x2="600" y2="260" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Session Check branches -->
  <line x1="660" y1="290" x2="720" y2="290" stroke="#dc3545" stroke-width="2" marker-end="url(#arrowheadRed)"/>
  <text x="690" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#dc3545">NO</text>

  <line x1="540" y1="290" x2="520" y2="290" stroke="#28a745" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
  <text x="530" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#28a745">YES</text>

  <!-- Session merge to Guardrail -->
  <line x1="450" y1="320" x2="450" y2="350" stroke="#333" stroke-width="2"/>
  <line x1="450" y1="350" x2="580" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="790" y1="320" x2="790" y2="350" stroke="#333" stroke-width="2"/>
  <line x1="790" y1="350" x2="620" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Guardrail Check branches -->
  <line x1="680" y1="410" x2="850" y2="410" stroke="#dc3545" stroke-width="2" marker-end="url(#arrowheadRed)"/>
  <text x="765" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#dc3545">OFF-TOPIC</text>

  <line x1="600" y1="440" x2="600" y2="500" stroke="#28a745" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
  <text x="610" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#28a745">ON-TOPIC</text>

  <!-- Intent Classification branches -->
  <line x1="520" y1="530" x2="220" y2="620" stroke="#dc3545" stroke-width="2" marker-end="url(#arrowheadRed)"/>
  <line x1="550" y1="540" x2="390" y2="620" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="560" x2="560" y2="620" stroke="#20c997" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
  <line x1="650" y1="540" x2="730" y2="620" stroke="#fd7e14" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="680" y1="530" x2="900" y2="620" stroke="#6c757d" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- All intents to Tool Execution -->
  <line x1="220" y1="700" x2="500" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="390" y1="700" x2="550" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="560" y1="700" x2="580" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="730" y1="700" x2="650" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="900" y1="700" x2="700" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Tool Execution to Success Check -->
  <line x1="600" y1="810" x2="600" y2="860" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Success Check branches -->
  <line x1="670" y1="890" x2="800" y2="890" stroke="#dc3545" stroke-width="2" marker-end="url(#arrowheadRed)"/>
  <text x="735" y="885" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#dc3545">FAIL</text>

  <line x1="600" y1="920" x2="600" y2="980" stroke="#28a745" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
  <text x="610" y="950" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#28a745">SUCCESS</text>

  <!-- Error Handling back to Response -->
  <line x1="800" y1="900" x2="700" y2="980" stroke="#dc3545" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowheadRed)"/>

  <!-- Off-topic to Final (bypass processing) -->
  <line x1="930" y1="440" x2="930" y2="1100" stroke="#dc3545" stroke-width="2" stroke-dasharray="10,5"/>
  <line x1="930" y1="1100" x2="630" y2="1130" stroke="#dc3545" stroke-width="2" stroke-dasharray="10,5" marker-end="url(#arrowheadRed)"/>

  <!-- Response Generation to Final -->
  <line x1="600" y1="1060" x2="600" y2="1100" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Decision Labels -->
  <text x="100" y="50" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#666">Decision Points:</text>
  <text x="100" y="70" font-family="Arial, sans-serif" font-size="10" fill="#666">◆ Session Management</text>
  <text x="100" y="85" font-family="Arial, sans-serif" font-size="10" fill="#666">◆ Topic Validation (Guardrails)</text>
  <text x="100" y="100" font-family="Arial, sans-serif" font-size="10" fill="#666">◆ Intent Classification</text>
  <text x="100" y="115" font-family="Arial, sans-serif" font-size="10" fill="#666">◆ Tool Selection</text>
  <text x="100" y="130" font-family="Arial, sans-serif" font-size="10" fill="#666">◆ Success Validation</text>
</svg>